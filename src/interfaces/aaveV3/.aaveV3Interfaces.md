# Aave Interfaces — Dev & AI Reference

> A compact developer & AI-focused repository guide that collects Aave v3 interfaces, mapping, usage patterns, strategy templates, and AI (DeepSeek) metadata to accelerate building strategies.

---

## 1. Goal

Provide a single, well‑organized reference repo that:

* Collects official Aave v3 interface files and common auxiliary interfaces (rewards, staking, auctions, strategy shapes).
* Documents **why** each interface exists and **how** to use it in strategy code.
* Provides small code snippets / recipes for common strategy flows (supply, borrow, repay, withdraw, claim rewards, stake AAVE, scaled accounting).
* Supplies AI-friendly metadata and queries so a search/agent (DeepSeek) can understand intent and assemble code patterns automatically.

---

## 2. Recommended directory structure (repo skeleton)

```
/aave-interfaces-reference/
├─ README.md
├─ LICENSE
├─ contracts/
│  ├─ interfaces/
│  │  ├─ aaveV3/
│  │  │  ├─ DataTypesV3.sol
│  │  │  ├─ IAToken.sol
│  │  │  ├─ IPool.sol
│  │  │  ├─ IPoolAddressesProvider.sol
│  │  │  ├─ IPoolDataProvider.sol
│  │  │  ├─ IProtocolDataProvider.sol
│  │  │  ├─ IReserveInterestRateStrategy.sol
│  │  │  ├─ IRewardsController.sol
│  │  │  ├─ IScaledBalanceToken.sol
│  │  │  ├─ IStakedAave.sol
│  │  │  └─ ... (official interfaces)
│  │  ├─ morphoV2/
│  │  ├─ spark/
│  │  └─ uniswap/
│  └─ external/
│     ├─ IAuction.sol
│     └─ IStrategyInterface.sol
├─ examples/
│  ├─ AaveV3Lender.sol           # minimal strategy using IPool
│  ├─ AaveScaledVault.sol        # ERC4626-like vault demonstrating scaled accounting
│  └─ StkAaveAutoCompound.sol    # autocompounder interacting with IStakedAave
├─ docs/
│  ├─ STRUCTS_DIAGRAM.md
│  ├─ FLOW_SUPPLY_BORROW.md
│  └─ AI_METADATA.md             # DeepSeek metadata & example prompts
├─ tests/
│  ├─ aave-v3-lender.test.js
│  └─ scaled-vault.test.js
├─ scripts/
│  ├─ deploy-local.js
│  └─ test-setup.js
└─ .github/workflows/ci.yml
```

---

## 3. Index & purpose of key interfaces (mapping table)

| Interface                                        |                                              Short purpose | When to use                                                          |
| ------------------------------------------------ | ---------------------------------------------------------: | -------------------------------------------------------------------- |
| `DataTypesV3.sol`                                |           Defines structs/Enums used across pool functions | Fundamental — used everywhere in logic and tests                     |
| `IPool.sol`                                      | Main entrypoint for supply/borrow/repay/withdraw/flashloan | Always use for active market operations                              |
| `IAToken.sol`                                    |                  ERC20 receipt token representing deposits | Read balances, transfer aTokens; limited actions (mint/burn by pool) |
| `IScaledBalanceToken.sol`                        |                 Access to scaled balances & previous index | Required for vault/accounting logic                                  |
| `IPoolAddressesProvider.sol`                     |    Registry of core addresses (Pool, Oracle, Configurator) | Use at init to resolve dynamic addresses                             |
| `IRewardsController.sol` / `IRewardsDistributor` |                              Incentives config & claim API | Use to read/claim rewards and update emissions                       |
| `IStakedAave.sol`                                |                    stkAAVE Safety Module staking interface | Use when strategy stakes AAVE                                        |
| `IAuction.sol`                                   |           Generic auction/liquidation interface (external) | For liquidation-via-auction strategies                               |
| `IReserveInterestRateStrategy.sol`               |                                           Rate curve hooks | For custom rate-analysis or simulation                               |

---

## 4. Developer recipes (short actionable examples)

> These are short code patterns. Full versions live in `/examples`.

### A. Resolve pool & supply

* Use `IPoolAddressesProvider.getPool()` to get the pool address (avoid hardcoding)
* `IPool(pool).supply(asset, amount, address(this), referral)`

### B. Compute totalAssets() using scaled balances

* `scaled = IScaledBalanceToken(aToken).scaledBalanceOf(self)`
* `index = pool.getReserveNormalizedIncome(asset)` (or `getReserveData` liquidityIndex)
* `real = scaled * index / RAY`

### C. Withdraw flow

* `IPool(pool).withdraw(asset, amount, to)` → returns actual withdrawn
* handle `type(uint256).max` as withdraw-all

### D. Claim & auto-compound rewards

* `IRewardsController.claimAllRewardsToSelf([aToken], address(this))`
* swap reward tokens on Uniswap/DEX → deposit underlying back to pool

### E. StkAAVE cooldown lifecycle

* `IStakedAave.stake(to, amount)` or transfer stkAAVE
* call `IStakedAave.cooldown()` to start timer
* after `getCooldownSeconds()` + within `UNSTAKE_WINDOW()`, call `redeem(to, amount)`

### F. Auction participation

* `id = IAuction.enable(from, receiver)` create auction
* check `IAuction.kickable(id)` then `IAuction.kick(id)` and `IAuction.take(id)`

---

## 5. AI/DeepSeek metadata & strategies for indexing (docs/AI_METADATA.md)

Include machine-readable metadata to help agents programmatically:

* `interfaces.json` — listing each interface, function signatures, tags (e.g., "supply", "borrow", "claimRewards", "scaledAccounting")
* `prompts/` — canned prompts showing how to combine interfaces into patterns
* `examples_manifest.json` — map example strategies to the interfaces they use

Sample intent tags per function (use for retrieval & plan generation):

* `supply`: [IPool.supply, IAToken.mint]
* `withdraw`: [IPool.withdraw, IAToken.burn]
* `borrow`: [IPool.borrow, IReserveInterestRateStrategy]
* `repay`: [IPool.repay, IPool.repayWithATokens]
* `claim`: [IRewardsController.claimAllRewardsToSelf]
* `stakeAave`: [IStakedAave.stake, cooldown, redeem]
* `calculateAssets`: [IScaledBalanceToken.scaledBalanceOf, DataTypesV3.liquidityIndex]

**Tip**: expose short natural-language summaries for each function in the JSON metadata to speed up LLM retrieval.

---

## 6. Security checklist / gotchas

* **Never** assume `aToken.redeem()` exists (Aave v3 routes withdraw via Pool).
* Use `getPool()` via `IPoolAddressesProvider` instead of hardcoded addresses.
* Watch `liquidityIndex` vs `getReserveNormalizedIncome()` — consistent naming across clients.
* When doing `repayWithATokens`, be careful with dust and `type(uint256).max`.
* When auto-compounding rewards, consider slippage, MEV, and bridging delays for unbacked mints.
* Handle `cooldown()` windows when using `IStakedAave` — that is off-chain-time sensitive.
* Flashloan mode: 0/1/2 semantics — ensure receiver contract properly handles `mode != 0`.

---

## 7. Testing / CI suggestions

* Setup local fork (Hardhat/Foundry) against mainnet or public testnet.
* Add fixtures for token balances and aToken mocks.
* Tests should assert: profit accounting via scaled balances, deposit/withdraw parity, reward claiming correctness, cooldown windows.
* Add static-analysis (Slither), coverage, and a `security.md` check that flags direct `transfer()` of ERC20 underlying.

---

## 8. Example README snippet for `examples/AaveV3Lender.sol`

> *Short description:* A minimal strategy that accepts ERC20 deposits and supplies them into Aave V3 using the Pool. It uses scaled accounting to report `totalAssets()` and supports `withdraw()` to return funds.

* Resolve pool with `IPoolAddressesProvider`
* On `deployFunds`: call `IERC20(asset).approve(pool, amount)` then `pool.supply(asset, amount, address(this), 0)`
* `totalAssets()` uses scaledBalance * index / RAY

---

## 9. Contribution & license

* MIT or AGPL‑3.0 (match Aave licensing choices for examples)
* Add `CONTRIBUTING.md` describing how to add new interfaces, update metadata, and add example strategies.

---

## 10. Next steps I can do right now

1. Generate all interface files (copied from Aave v3 canonical contracts) into `/contracts/interfaces/aaveV3/`.
2. Produce the `examples/AaveV3Lender.sol` and `AaveScaledVault.sol` minimal implementations with tests.
3. Produce `docs/AI_METADATA.md` and a machine readable `interfaces.json` for DeepSeek.

Pick which you'd like me to generate now (1, 2, 3 or `all`).
